# Cookie 랑 Session 차이가 무예요~?

### 주제 선정 이유

워크인코리아 프로젝트를 진행하면서 cookie 설정으로 꽤 오래 고생했다! (나 말고 다른 팀원이)

## 🍪 Cookie

- 쿠키는 웹 브라우저와 웹 서버 간의 상태를 유지하고 관리하기 위한 작은 데이터 조각이다.
- 클라이언트 (웹 브라우저) 가 서버에 요청을 보낼 때, 서버는 해당 요청에 대한 응답과 함께 웹 브라우저에 **작은 데이터 조각인** 쿠키를 전송한다.
- 이 데이터는 웹 브라우저에 저장되어 있으며, 동일한 서버에 재요청이 발생할 때 함께 전송된다.
- 이를 통해 HTTP Stateless 속성을 극복하게 된다.

- 즉, 서버와 웹 브라우저 간의 연결을 유지하기 위한 식별 데이터로 활용된다.

  - 세션 관리 - 서버에 저장해야 할 로그인, 장바구니, 게임 스코어 등의 정보 관리
  - 개인화 - 사용자 선호, 테마 등의 세팅
  - 트래킹 - 사용자 행동을 기록하고 분석하는 용도

### 🍪 Cookie 저장 장소

- Cookie 는 웹 브라우저의 쿠키 스토리지에 저장되어 있다.
- Cookie 에는 이름, 값, Domain, Path, Expiers/Max-Age, Secure 등의 정보가 포함되어 있다.

### 🍪 Cookie 생성과 저장 과정

1. 클라이언트가 웹 브라우저로 서버에 첫 요청을 보낸다.
2. 서버는 클라이언트에 대한 상태 데이터 (이름, 나이 등) 를 웹 브라우저로 보낸다.
3. 웹 브라우저는 받은 상태 데이터를 저장하는 데 이를 Cookie 라 한다.
4. 클라이언트가 같은 서버에 두 번째 요청할 때 Cookie도 요청과 같이 서버로 보내진다.
5. 서버는 Cookie를 통해 클라이언트가 누구인지 전에는 무슨 요청했는지를 알고 응답을 해준다.

### 🍪 Session Cookie, Persistent Cookie

- Persistent Cookie 는 Expires 속성에 명시된 날짜에 삭제되거나 Max-Age 속성에 명시된 기간 이후에 삭제된다.
- Session Cookie 는 현재 세션이 끝날 때 삭제된다.

### 🍪 Cookie 보안

쿠키 보안에는 HttpOnly, Secure, SameSite 가 있다.

- HttpOnly : JavaScript 에서 접근 가능 여부
  - XSS 공격을 방지하기 위해서 HttpOnly 는 JavaScript 의 API 에 접근할 수 없다.
  - 서버에 전송되기만 하는 Cookies
- Secure : HTTPS 요청에 대해서만 전송 여부
  - HTTPS 프로토콜 상에서 암호화된 요청일 경우에만 전송된다.
- SameSite : Same-Origin 에서만 전송 여부
  - cross-site 요청과 함께 전송되지 않았음을 요구하게 만든다.
  - cross-site 요청 위조 공격 (CSRF) 에 대해 보호 방법을 제공

### 🍪 Cookie 제어

웹 서버가 HTTP Cache 를 Cache-control 응답 헤더로 제어하는 것과 같이, Cookie 또한 Set-Cookie 헤더를 통해 웹 브라우저 저장을 제어한다.

### 🍪 Cookie 장단점

- 장점
  - 쿠키는 브라우저에 있기 때문에 서버에 요청 시 속도가 빠르다
- 단점
  - 쿠키는 웹 브라우저에 저장이 되기 때문에 민감 정보 저장에서 안전 x
  - 웹 브라우저 간 공유가 불가능하다. 웹 브라우저 단위의 저장소이기 때문에 지역성 문제가 발생
  - Cookie 는 Domain + Path 가 일치 시 해당 웹 서버로 모든 쿠키를 담아 보내기 때문에 저장하려는 정보량이 많아질수록 요청 크기가 커진다. 불필요한 Network Overhead 가 발생한다.

## 🥦 Session

- Session 의 사전적 정의 : (특정한 활동을 위한) 시간 [기간]
- 브라우저가 종료되기 전까지 클라이언트의 요청을 유지하게 해주는 기술
- 서버에 클라이언트의 상태 정보를 저장하고 요청이 들어올 때마다 상태 데이터를 확인하여 Stateful 하게 한다.

- Session 은 열고 닫힘이 하나의 쌍으로 이루어진다.
  - 로그인 세션 : 로그인 한 뒤 / 로그아웃 하기까지
  - HTTP 세선 : TCP/UDP 연결 후 Request 전송 / Response 받기까지
  - 브라우저 세션 : 하나의 탭/창이 열리고 / 닫히기 까지

### 🥦 Session 저장 장소

- Session 은 상태 데이터 (이름, 나이 등) 를 웹 서버에 저장하는데, 저장 장소를 Session Store 라고 한다.
- Session Store 는 Session-ID 를 쿠키로 보내오면 서버는 Session Store 에서 ID 를 찾아서 상태 데이터를 읽어 Stateful 상태를 유지한다.

### 🥦 Session 일 때의 동작 과정

1. 클라이언트가 웹 브라우저로 서버에 요청을 보낸다.
2. 서버는 클라이언트에 대한 상태 데이터(이름, 나이 등등)를 서버에 저장 하고, Session-ID 를 생성해 웹 브라우저로 보낸다.
3. 웹 브라우저는 받은 \_Session-ID를 Cookie 에 저장 한다.
4. 클라이언트가 같은 서버에 두 번째 요청할 때 Cookie 도 요청과 같이 서버로 전송된다.
5. 서버는 Cookie를 통해 클라이언트가 누구인지, 이전에는 어떤 요청했는지를 알고, 이 정보를 기반으로 응답을 해준다.

### 🥦 Session 장단점

- 장점
  - 보안이 쿠키 보다 우수하다! 민감 정보들이 웹 서버 측에 안전하게 저장된다.
  - 웹 브라우저 간 공유가 가능하다.
- 단점
  - 세션은 정보가 서버에 있기 때문에 처리가 비교적 느린 속도를 가진다.
